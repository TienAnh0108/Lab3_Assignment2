<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Weather Dashboard</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
    }

    .search-box {
      background: white;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    .search-box input {
      width: 70%;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
    }

    .search-box button {
      width: 28%;
      padding: 12px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin-left: 2%;
    }

    .weather-card {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      margin-bottom: 20px;
    }

    .current-weather {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .temp-display {
      font-size: 60px;
      font-weight: bold;
    }

    .forecast-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .forecast-item {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
    }

    .loading {
      text-align: center;
      padding: 40px;
      font-size: 18px;
      color: white;
    }

    .error {
      background: #dc3545;
      color: white;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .recent-searches {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .recent-city {
      padding: 5px 15px;
      background: #e9ecef;
      border-radius: 20px;
      cursor: pointer;
      font-size: 14px;
    }

    .recent-city:hover {
      background: #dee2e6;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1 style="color: white; text-align: center; margin-bottom: 30px;">
      Weather Dashboard
    </h1>

    <div class="search-box">
      <input type="text" id="cityInput" placeholder="Enter city name..."
        onkeypress="if(event.key==='Enter') searchWeather()">
      <button onclick="searchWeather()">Search</button>
      <div class="recent-searches" id="recentSearches"></div>
    </div>

    <div id="errorMessage"></div>
    <div id="weatherDisplay"></div>
    <div id="forecastDisplay"></div>
  </div>

  <script>
    const API_KEY = 'c3dab1f34c726169b85d6463a1d47e61'; // Get from openweathermap.org
    const WEATHER_URL = 'https://api.openweathermap.org/data/2.5/weather';
    const FORECAST_URL = 'https://api.openweathermap.org/data/2.5/forecast';

    const cityInput = document.getElementById('cityInput');
    const weatherDisplay = document.getElementById('weatherDisplay');
    const forecastDisplay = document.getElementById('forecastDisplay');
    const errorMessageDiv = document.getElementById('errorMessage');
    const recentSearchesDiv = document.getElementById('recentSearches');

    function clearDisplay(message = 'Loading...') {
      weatherDisplay.innerHTML = `<div class="loading">${message}</div>`;
      forecastDisplay.innerHTML = '';
      clearError();
    }

    function showError(message) {
      errorMessageDiv.className = 'error';
      errorMessageDiv.innerHTML = message;
      weatherDisplay.innerHTML = '';
      forecastDisplay.innerHTML = '';
    }

    function clearError() {
      errorMessageDiv.innerHTML = '';
    }

    async function fetchWeather(city) {
      const url = `${WEATHER_URL}?q=${encodeURIComponent(city)}&appid=${API_KEY}&units=metric&lang=en`;
      try {
        const response = await fetch(url);
        if (!response.ok) {
          if (response.status === 404) {
            throw new Error(`City not found: ${city}. Please check the name.`);
          }
          throw new Error(`HTTP Error: ${response.status}.`);
        }
        return await response.json();
      } catch (error) {
        throw error;
      }
    }

    async function fetchForecast(city) {
      const url = `${FORECAST_URL}?q=${encodeURIComponent(city)}&appid=${API_KEY}&units=metric&lang=en`;
      try {
        const response = await fetch(url);
        if (!response.ok) {
          throw new Error(`HTTP Error: ${response.status} while fetching forecast.`);
        }
        return await response.json();
      } catch (error) {
        throw error;
      }
    }

    function displayWeather(data) {
      const tempC = Math.round(data.main.temp);
      const description = data.weather[0].description;
      const iconCode = data.weather[0].icon;
      const iconUrl = `https://openweathermap.org/img/wn/${iconCode}@2x.png`;

      weatherDisplay.innerHTML = `
        <div class="weather-card">
            <h2>${data.name}, ${data.sys.country}</h2>
            <div class="current-weather">
                <div>
                    <span class="temp-display">${tempC}°C</span>
                    <p style="text-transform: capitalize;">${description}</p>
                </div>
                <div>
                    <img src="${iconUrl}" alt="${description}" width="100">
                </div>
            </div>
            <hr style="margin: 15px 0;">
            <p>Humidity: <strong>${data.main.humidity}%</strong></p>
            <p>Wind Speed: <strong>${data.wind.speed} m/s</strong></p>
            <p>Feels like: <strong>${Math.round(data.main.feels_like)}°C</strong></p>
        </div>
    `;
    }

    function displayForecast(data) {
      const forecastList = data.list;
      const dailyForecasts = {};
      const today = new Date().toLocaleDateString('en-US');

      for (let item of forecastList) {
        const date = new Date(item.dt * 1000);
        const dateStr = date.toLocaleDateString('en-US');

        if (dateStr === today) continue;

        if (!dailyForecasts[dateStr] && date.getHours() >= 10 && date.getHours() <= 14) {
          dailyForecasts[dateStr] = item;
        } else if (!dailyForecasts[dateStr]) {
          dailyForecasts[dateStr] = item;
        }
      }

      const forecastCards = Object.values(dailyForecasts).slice(0, 5).map(item => {
        const date = new Date(item.dt * 1000);
        const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });
        const iconCode = item.weather[0].icon;
        const temp = Math.round(item.main.temp);

        return `
            <div class="forecast-item">
                <p><strong>${dayName}</strong></p>
                <img src="https://openweathermap.org/img/wn/${iconCode}.png" alt="Icon">
                <p>${temp}°C</p>
                <p style="font-size: 0.8em; color: #6c757d; text-transform: capitalize;">${item.weather[0].description}</p>
            </div>
        `;
      }).join('');

      forecastDisplay.innerHTML = `
        <div class="weather-card">
            <h3>5-Day Forecast</h3>
            <div class="forecast-grid">
                ${forecastCards}
            </div>
        </div>
    `;
    }

    function saveRecentSearch(city) {
      const cityClean = city.trim();
      let searches = JSON.parse(localStorage.getItem('recentCities') || '[]');

      searches = searches.filter(c => c.toLowerCase() !== cityClean.toLowerCase());

      searches.unshift(cityClean);

      if (searches.length > 5) {
        searches.pop();
      }

      localStorage.setItem('recentCities', JSON.stringify(searches));
      loadRecentSearches();
    }

    function loadRecentSearches() {
      let searches = JSON.parse(localStorage.getItem('recentCities') || '[]');
      recentSearchesDiv.innerHTML = '';

      searches.forEach(city => {
        const cityElement = document.createElement('span');
        cityElement.className = 'recent-city';
        cityElement.textContent = city;
        cityElement.onclick = () => {
          cityInput.value = city;
          searchWeather();
        };
        recentSearchesDiv.appendChild(cityElement);
      });
    }

    async function searchWeather() {
      const city = cityInput.value.trim();
      if (!city) {
        showError('Please enter a city name.');
        return;
      }

      clearDisplay();

      try {
        const weatherData = await fetchWeather(city);
        displayWeather(weatherData);

        const forecastData = await fetchForecast(city);
        displayForecast(forecastData);

        saveRecentSearch(city);

      } catch (error) {
        showError(error.message);
      }
    }
    loadRecentSearches();
  </script>
</body>

</html>